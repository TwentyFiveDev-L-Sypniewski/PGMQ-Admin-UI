@rendermode InteractiveServer
@inject NotificationService NotificationService
@implements IDisposable

@foreach (var notification in _notifications)
{
    <FluentMessageBar Intent="@notification.Intent" @key="notification">
        @notification.Message
    </FluentMessageBar>
}

@code {
    private readonly List<NotificationMessage> _notifications = [];

    protected override void OnInitialized()
    {
        NotificationService.OnNotification += HandleNotification;
    }

    private async void HandleNotification(NotificationMessage notification)
    {
        _notifications.Add(notification);
        await InvokeAsync(StateHasChanged);

        // Auto-dismiss after duration
        await Task.Delay(notification.DurationMs);
        _notifications.Remove(notification);
        await InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        NotificationService.OnNotification -= HandleNotification;
    }
}
